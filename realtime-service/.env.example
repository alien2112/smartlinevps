#-----------------------------------------------------------------------
# SMARTLINE REAL-TIME SERVICE CONFIGURATION
#-----------------------------------------------------------------------
# All values in this file can be edited to customize the service behavior
# without modifying any code. Copy to .env and adjust as needed.
#-----------------------------------------------------------------------

#-----------------------------------------------------------------------
# SERVER CONFIGURATION
#-----------------------------------------------------------------------
NODE_ENV=development
PORT=3000
HOST=0.0.0.0

#-----------------------------------------------------------------------
# REDIS CONFIGURATION
#-----------------------------------------------------------------------
# Set REDIS_ENABLED=true for production with clustering support
#-----------------------------------------------------------------------
REDIS_ENABLED=false
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_MAX_RETRIES=3

#-----------------------------------------------------------------------
# LARAVEL API CONFIGURATION
#-----------------------------------------------------------------------
# URL and authentication for Laravel backend communication
#-----------------------------------------------------------------------
LARAVEL_API_URL=http://localhost:8000
LARAVEL_API_KEY=your-secret-api-key
LARAVEL_API_TIMEOUT_MS=5000
VALIDATE_WITH_LARAVEL=false

#-----------------------------------------------------------------------
# JWT CONFIGURATION
#-----------------------------------------------------------------------
# Secret key for JWT token validation (must match Laravel's)
#-----------------------------------------------------------------------
JWT_SECRET=your-jwt-secret-key

#-----------------------------------------------------------------------
# WEBSOCKET CONFIGURATION
#-----------------------------------------------------------------------
# WebSocket server settings for real-time communication
#-----------------------------------------------------------------------
WS_CORS_ORIGIN=*
WS_PING_TIMEOUT=60000
WS_PING_INTERVAL=25000
WS_MAX_BUFFER_SIZE=1000000
WS_TRANSPORTS=websocket,polling

#-----------------------------------------------------------------------
# LOCATION TRACKING CONFIGURATION
#-----------------------------------------------------------------------
# Controls how driver location updates are processed
#-----------------------------------------------------------------------
# Minimum time between location updates per driver (milliseconds)
LOCATION_UPDATE_THROTTLE_MS=1000

# Maximum location history entries to keep
MAX_LOCATION_HISTORY=100

# How long to keep driver location data in Redis (seconds)
LOCATION_EXPIRY_SECONDS=3600

# How long to keep ride context data (seconds) - 6 hours default
RIDE_CONTEXT_EXPIRY_SECONDS=21600

#-----------------------------------------------------------------------
# DRIVER MATCHING CONFIGURATION
#-----------------------------------------------------------------------
# Controls how rides are dispatched to nearby drivers
#-----------------------------------------------------------------------
# Search radius for finding nearby drivers (kilometers)
DRIVER_SEARCH_RADIUS_KM=10

# Maximum number of drivers to notify for a single ride
MAX_DRIVERS_TO_NOTIFY=10

# Timeout for driver to accept ride (seconds)
DRIVER_MATCH_TIMEOUT_SECONDS=120

# Number of retry attempts for ride dispatch
RIDE_DISPATCH_RETRIES=3

# How long ride notification stays valid (seconds)
RIDE_NOTIFICATION_EXPIRY_SECONDS=30

#-----------------------------------------------------------------------
# PERFORMANCE CONFIGURATION
#-----------------------------------------------------------------------
# Performance tuning for high-load scenarios
#-----------------------------------------------------------------------
# Maximum WebSocket connections per server instance
MAX_CONNECTIONS_PER_INSTANCE=10000

# Enable Node.js cluster mode for multi-core support
CLUSTER_MODE=false

# Number of worker processes (0 = auto-detect CPUs)
WORKER_PROCESSES=2

#-----------------------------------------------------------------------
# SECURITY CONFIGURATION
#-----------------------------------------------------------------------
# Authentication and security settings
#-----------------------------------------------------------------------
# Enforce that customers can only subscribe to their own rides
ENFORCE_RIDE_SUBSCRIPTION_AUTH=true

# Grace period before marking driver offline after disconnect (ms)
DISCONNECT_OFFLINE_GRACE_MS=30000

#-----------------------------------------------------------------------
# RATE LIMITING CONFIGURATION
#-----------------------------------------------------------------------
# Per-socket, per-event rate limits to prevent abuse
#-----------------------------------------------------------------------
# Driver online/offline events
RATE_LIMIT_DRIVER_ONLINE_WINDOW_MS=60000
RATE_LIMIT_DRIVER_ONLINE_MAX=10
RATE_LIMIT_DRIVER_OFFLINE_WINDOW_MS=60000
RATE_LIMIT_DRIVER_OFFLINE_MAX=10

# Ride acceptance rate limit
RATE_LIMIT_ACCEPT_RIDE_WINDOW_MS=10000
RATE_LIMIT_ACCEPT_RIDE_MAX=5

# Customer ride subscription rate limits
RATE_LIMIT_SUBSCRIBE_WINDOW_MS=60000
RATE_LIMIT_SUBSCRIBE_MAX=30
RATE_LIMIT_UNSUBSCRIBE_WINDOW_MS=60000
RATE_LIMIT_UNSUBSCRIBE_MAX=60

# Ping/heartbeat rate limit
RATE_LIMIT_PING_WINDOW_MS=10000
RATE_LIMIT_PING_MAX=50

#-----------------------------------------------------------------------
# LOGGING CONFIGURATION
#-----------------------------------------------------------------------
# Log level: error, warn, info, http, verbose, debug, silly
LOG_LEVEL=info
LOG_DIR=./logs
