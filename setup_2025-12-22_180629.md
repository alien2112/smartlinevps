VPS setup guide (Node.js + Laravel) - 2025-12-22_180629
Assumes Ubuntu 22.04 LTS, non-root deploy user `deploy`, domains node.example.com / laravel.example.com, Node app on port 3000, Laravel with PHP 8.2, nginx, ufw, certbot, MySQL; adjust for your stack.

1) Base server hardening
- Login: ssh root@SERVER_IP
- Add sudo user: adduser deploy && usermod -aG sudo deploy
- SSH hardening: copy ssh key to /home/deploy/.ssh/authorized_keys; set perms 700/.ssh, 600 authorized_keys; in /etc/ssh/sshd_config set PasswordAuthentication no and PermitRootLogin no; systemctl reload sshd
- Updates/timezone: apt update && apt upgrade -y; timedatectl set-timezone UTC
- Firewall: ufw allow OpenSSH; ufw allow "Nginx Full"; ufw enable
- Swap (optional 2G): fallocate -l 2G /swapfile; chmod 600 /swapfile; mkswap /swapfile; swapon /swapfile; echo "/swapfile none swap sw 0 0" >> /etc/fstab

2) Common packages
apt install -y build-essential git curl unzip software-properties-common ca-certificates ufw fail2ban

3) Node.js stack
- Install nvm + LTS: curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash; source ~/.nvm/nvm.sh; nvm install --lts; corepack enable
- Process manager: npm install -g pm2
- App deploy:
  sudo mkdir -p /var/www/nodeapp && sudo chown -R deploy:deploy /var/www/nodeapp
  cd /var/www/nodeapp
  git clone <repo> . (or scp)
  cp .env.example .env && edit; npm ci (or pnpm install)
  pm2 start npm --name nodeapp -- start
  pm2 save; pm2 startup systemd -u deploy --hp /home/deploy
- Update:
  cd /var/www/nodeapp && git pull && npm ci && pm2 reload nodeapp

4) Laravel/PHP stack
- PHP 8.2:
  add-apt-repository ppa:ondrej/php -y && apt update
  apt install -y php8.2 php8.2-fpm php8.2-cli php8.2-common php8.2-mysql php8.2-pgsql php8.2-redis php8.2-curl php8.2-xml php8.2-mbstring php8.2-zip php8.2-gd php8.2-bcmath php8.2-intl
- Composer:
  cd /tmp && php -r "copy('https://getcomposer.org/installer','composer-setup.php');" && php composer-setup.php --install-dir=/usr/local/bin --filename=composer
- DB (MySQL example):
  apt install -y mysql-server && mysql_secure_installation
  mysql -u root -p -e "CREATE DATABASE laravel CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
  mysql -u root -p -e "CREATE USER 'laravel'@'%' IDENTIFIED BY 'strongpass';"
  mysql -u root -p -e "GRANT ALL PRIVILEGES ON laravel.* TO 'laravel'@'%'; FLUSH PRIVILEGES;"
- App deploy:
  sudo mkdir -p /var/www/laravel && sudo chown -R deploy:www-data /var/www/laravel
  cd /var/www/laravel
  git clone <repo> . (or scp)
  cp .env.example .env && edit DB_*, APP_URL, QUEUE_CONNECTION, CACHE_DRIVER, SESSION_DRIVER, MAIL_*
  sudo -u deploy composer install --no-dev --optimize-autoloader
  php artisan key:generate
  php artisan migrate --seed
  php artisan storage:link
  sudo chown -R deploy:www-data /var/www/laravel
  sudo find storage bootstrap/cache -type d -exec chmod 775 {} \;
- Queue workers (Supervisor): create /etc/supervisor/conf.d/laravel-worker.conf:
  [program:laravel-worker]
  process_name=%(program_name)s_%(process_num)02d
  command=php /var/www/laravel/artisan queue:work --sleep=3 --tries=3 --timeout=90
  autostart=true
  autorestart=true
  user=deploy
  numprocs=1
  redirect_stderr=true
  stdout_logfile=/var/log/supervisor/laravel-worker.log
  Then: supervisorctl reread && supervisorctl update && supervisorctl start laravel-worker:*
- Scheduler (cron):
  * * * * * deploy php /var/www/laravel/artisan schedule:run >> /dev/null 2>&1

5) Nginx
- Install: apt install -y nginx
- Node reverse proxy /etc/nginx/sites-available/nodeapp:
  server {
    listen 80;
    server_name node.example.com;
    location / {
      proxy_pass http://127.0.0.1:3000;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_cache_bypass $http_upgrade;
    }
    access_log /var/log/nginx/nodeapp.access.log;
    error_log /var/log/nginx/nodeapp.error.log;
  }
  ln -s /etc/nginx/sites-available/nodeapp /etc/nginx/sites-enabled/nodeapp
- Laravel vhost /etc/nginx/sites-available/laravel:
  server {
    listen 80;
    server_name laravel.example.com;
    root /var/www/laravel/public;
    index index.php index.html;
    location / {
      try_files $uri $uri/ /index.php?$query_string;
    }
    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
    }
    location ~ /\.ht {
      deny all;
    }
    access_log /var/log/nginx/laravel.access.log;
    error_log /var/log/nginx/laravel.error.log;
  }
  ln -s /etc/nginx/sites-available/laravel /etc/nginx/sites-enabled/laravel
- Test & reload: nginx -t && systemctl reload nginx
- HTTPS: apt install -y certbot python3-certbot-nginx; certbot --nginx -d node.example.com -d laravel.example.com --redirect --email you@example.com --agree-tos --no-eff-email

6) Monitoring/ops
- PM2: pm2 status; logs: pm2 logs nodeapp
- Laravel logs: tail -f /var/www/laravel/storage/logs/laravel.log
- nginx logs: tail -f /var/log/nginx/*.log
- PHP-FPM: journalctl -u php8.2-fpm
- Backups: nightly mysqldump/pg_dump + rsync/s3 of /var/www/*
- Security: keep packages updated; enable fail2ban; rotate keys/passwords

7) Rolling deployment checklist
- Pull latest, install deps, run tests locally
- Maintenance: php /var/www/laravel/artisan down --render="errors::503" (then up)
- Deploy: git pull, composer install --no-dev --optimize-autoloader, php artisan migrate --force, php artisan up
- Restart workers: pm2 reload nodeapp; supervisorctl restart laravel-worker:*
- Verify health endpoints and logs

References
- Node app root: /var/www/nodeapp
- Laravel root: /var/www/laravel
- Configs: /etc/nginx/sites-available/{nodeapp,laravel}, /etc/supervisor/conf.d/laravel-worker.conf
