; ============================================
; PHP OPcache Settings for Production
; ============================================
; Copy to: /etc/php/8.2/fpm/conf.d/10-opcache.ini
; ============================================

; Enable OPcache
opcache.enable=1

; Memory consumption (MB) - increase for large codebases
opcache.memory_consumption=256

; Interned strings buffer size (MB)
opcache.interned_strings_buffer=16

; Maximum number of PHP files to cache
; Laravel apps typically need 15000-20000
opcache.max_accelerated_files=20000

; Do not check file timestamps in production
; Set to 0 for production (faster)
; Set to 1 for development (auto-recompile on file change)
opcache.validate_timestamps=0

; Keep docblocks (needed for some Laravel features)
opcache.save_comments=1

; Fast shutdown sequence
opcache.fast_shutdown=1

; Disable OPcache for CLI (not needed)
opcache.enable_cli=0

; ============================================
; JIT Compilation (PHP 8.0+)
; ============================================
; 1255 = tracing JIT with optimizations
; Use 1254 for more aggressive optimization
opcache.jit=1255

; JIT buffer size
opcache.jit_buffer_size=128M

; ============================================
; Error Logging
; ============================================
opcache.log_verbosity_level=1
opcache.error_log=/var/log/php-opcache.log

; ============================================
; File Cache (Optional - speeds up restarts)
; ============================================
; opcache.file_cache=/tmp/opcache
; opcache.file_cache_only=0
; opcache.file_cache_consistency_checks=1
