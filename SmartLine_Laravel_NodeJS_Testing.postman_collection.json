{
	"info": {
		"_postman_id": "smartline-full-testing-2025",
		"name": "SmartLine - Laravel + Node.js Testing",
		"description": "Complete testing collection for Laravel API and Node.js real-time service",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Laravel API",
			"item": [
				{
					"name": "Authentication",
					"item": [
						{
							"name": "1. Driver Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = pm.response.json();",
											"if (jsonData.data && jsonData.data.token) {",
											"    pm.environment.set(\"auth_token\", jsonData.data.token);",
											"    pm.environment.set(\"driver_id\", jsonData.data.id);",
											"    console.log(\"Driver Token saved: \" + jsonData.data.token);",
											"    console.log(\"Driver ID: \" + jsonData.data.id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"phone\": \"+201208673028\",\n    \"password\": \"password123\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/customer/auth/login",
									"host": ["{{base_url}}"],
									"path": ["api", "customer", "auth", "login"]
								},
								"description": "Login driver and save JWT token"
							}
						},
						{
							"name": "2. Customer Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = pm.response.json();",
											"if (jsonData.data && jsonData.data.token) {",
											"    pm.environment.set(\"customer_auth_token\", jsonData.data.token);",
											"    pm.environment.set(\"customer_id\", jsonData.data.id);",
											"    console.log(\"Customer Token saved: \" + jsonData.data.token);",
											"    console.log(\"Customer ID: \" + jsonData.data.id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"phone\": \"+201012748258\",\n    \"password\": \"password123\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/customer/auth/login",
									"host": ["{{base_url}}"],
									"path": ["api", "customer", "auth", "login"]
								},
								"description": "Login customer and save JWT token"
							}
						}
					]
				},
				{
					"name": "Driver Endpoints",
					"item": [
						{
							"name": "3. Get Pending Rides",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{auth_token}}"
									},
									{
										"key": "zoneId",
										"value": "{{zone_id}}",
										"description": "REQUIRED: Driver's zone ID"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/driver/ride/pending-ride-list?limit=10&offset=1",
									"host": ["{{base_url}}"],
									"path": ["api", "driver", "ride", "pending-ride-list"],
									"query": [
										{
											"key": "limit",
											"value": "10"
										},
										{
											"key": "offset",
											"value": "1"
										}
									]
								},
								"description": "Get list of pending ride requests for driver"
							}
						},
						{
							"name": "4. Update Ride Status to Accepted",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{auth_token}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"trip_request_id\": \"{{ride_id}}\",\n    \"current_status\": \"accepted\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/driver/ride/status-update",
									"host": ["{{base_url}}"],
									"path": ["api", "driver", "ride", "status-update"]
								},
								"description": "Driver accepts a ride"
							}
						},
						{
							"name": "5. Update Ride Status to Started",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{auth_token}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"trip_request_id\": \"{{ride_id}}\",\n    \"current_status\": \"started\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/driver/ride/status-update",
									"host": ["{{base_url}}"],
									"path": ["api", "driver", "ride", "status-update"]
								},
								"description": "Driver starts the ride"
							}
						},
						{
							"name": "6. Update Ride Status to Completed",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{auth_token}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"trip_request_id\": \"{{ride_id}}\",\n    \"current_status\": \"completed\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/driver/ride/status-update",
									"host": ["{{base_url}}"],
									"path": ["api", "driver", "ride", "status-update"]
								},
								"description": "Driver completes the ride"
							}
						}
					]
				},
				{
					"name": "Customer Endpoints",
					"item": [
						{
							"name": "7. Create Ride Request",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = pm.response.json();",
											"if (jsonData.data && jsonData.data.id) {",
											"    pm.environment.set(\"ride_id\", jsonData.data.id);",
											"    console.log(\"Ride ID saved: \" + jsonData.data.id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{customer_auth_token}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"pickup_latitude\": 30.0444,\n    \"pickup_longitude\": 31.2357,\n    \"pickup_address\": \"Cairo, Egypt\",\n    \"destination_latitude\": 30.0626,\n    \"destination_longitude\": 31.2497,\n    \"destination_address\": \"Heliopolis, Cairo\",\n    \"vehicle_category_id\": \"select-from-config\",\n    \"payment_method\": \"cash\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/customer/ride/request",
									"host": ["{{base_url}}"],
									"path": ["api", "customer", "ride", "request"]
								},
								"description": "Customer creates a new ride request"
							}
						},
						{
							"name": "8. Get Ride Details",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{customer_auth_token}}"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/customer/ride/{{ride_id}}",
									"host": ["{{base_url}}"],
									"path": ["api", "customer", "ride", "{{ride_id}}"]
								},
								"description": "Get details of a specific ride"
							}
						},
						{
							"name": "9. Rate Driver",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{customer_auth_token}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"trip_request_id\": \"{{ride_id}}\",\n    \"rating\": 5,\n    \"comment\": \"Great ride!\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/customer/ride/rate",
									"host": ["{{base_url}}"],
									"path": ["api", "customer", "ride", "rate"]
								},
								"description": "Customer rates the driver after ride completion"
							}
						}
					]
				}
			]
		},
		{
			"name": "Node.js Real-time Service",
			"item": [
				{
					"name": "Health & Monitoring",
					"item": [
						{
							"name": "1. Health Check",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{nodejs_url}}/health",
									"host": ["{{nodejs_url}}"],
									"path": ["health"]
								},
								"description": "Check if Node.js service is running"
							}
						},
						{
							"name": "2. Get Metrics",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{nodejs_url}}/metrics",
									"host": ["{{nodejs_url}}"],
									"path": ["metrics"]
								},
								"description": "Get service metrics (connections, active drivers, memory)"
							}
						}
					]
				},
				{
					"name": "WebSocket Event Testing",
					"item": [
						{
							"name": "Note: WebSocket Testing",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{nodejs_url}}/",
									"host": ["{{nodejs_url}}"],
									"path": [""]
								},
								"description": "WebSocket events cannot be tested directly in Postman.\n\nTo test WebSocket events, use one of these methods:\n\n**Method 1: Browser Console**\n```javascript\n// In browser console\nconst socket = io('http://localhost:3000', {\n  auth: { token: 'YOUR_JWT_TOKEN' }\n});\n\nsocket.on('connect', () => {\n  console.log('Connected');\n  \n  // Driver go online\n  socket.emit('driver:online', {\n    location: { latitude: 30.0444, longitude: 31.2357 },\n    vehicle_category_id: 'uuid',\n    vehicle_id: 'uuid',\n    name: 'Driver Name'\n  });\n});\n\nsocket.on('ride:new', (data) => {\n  console.log('New ride:', data);\n});\n```\n\n**Method 2: wscat CLI Tool**\n```bash\nnpm install -g wscat\nwscat -c \"ws://localhost:3000?token=YOUR_JWT_TOKEN\"\n```\n\n**Method 3: Socket.IO Client (Node.js)**\nSee test-service.js in realtime-service folder\n\n**Common Events to Test:**\n\n**Driver Events (emit):**\n- driver:online\n- driver:offline\n- driver:location\n- driver:accept:ride\n\n**Driver Events (listen):**\n- ride:new\n- ride:accept:success\n- ride:accept:failed\n- ride:taken\n\n**Customer Events (emit):**\n- customer:subscribe:ride\n- customer:unsubscribe:ride\n\n**Customer Events (listen):**\n- driver:location:update\n- ride:driver_assigned\n- ride:started\n- ride:completed"
							}
						}
					]
				},
				{
					"name": "Internal API (Node.js ↔ Laravel)",
					"item": [
						{
							"name": "Note: Internal APIs",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/internal",
									"host": ["{{base_url}}"],
									"path": ["api", "internal"]
								},
								"description": "These endpoints are called by Node.js service, not by clients.\n\nThey are protected by the INTERNAL_API_KEY.\n\n**Available Internal Endpoints:**\n\n1. POST /api/internal/ride/assign-driver\n   - Called when driver accepts a ride\n   - Body: { ride_id, driver_id }\n   \n2. POST /api/internal/events/{event}\n   - Called for various events\n   - Events: ride.no_drivers, ride.timeout\n\n**Testing Internal APIs:**\n\nYou can test them manually using Postman by adding:\n- Header: X-API-Key: smartline-internal-key-change-in-production\n\nBut in production, only Node.js should call these endpoints."
							}
						}
					]
				}
			]
		},
		{
			"name": "Integration Tests",
			"item": [
				{
					"name": "Complete Ride Flow Test",
					"item": [
						{
							"name": "Flow Guide",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/",
									"host": ["{{base_url}}"],
									"path": [""]
								},
								"description": "**Complete Ride Flow Testing Guide**\n\n**Step 1: Setup**\n1. Ensure Laravel is running (php artisan serve)\n2. Ensure Node.js is running (cd realtime-service && npm run dev)\n3. Ensure Redis is running (redis-cli ping)\n\n**Step 2: Driver Goes Online**\n1. Run: \"1. Driver Login\" (Laravel API → Authentication)\n2. Connect driver via WebSocket (see WebSocket testing methods)\n3. Emit: driver:online event\n4. Verify in Redis: redis-cli ZCARD drivers:locations\n\n**Step 3: Customer Creates Ride**\n1. Run: \"2. Customer Login\" (Laravel API → Authentication)\n2. Run: \"7. Create Ride Request\" (Laravel API → Customer Endpoints)\n3. Check Node.js logs: should see \"Received event: laravel:ride.created\"\n4. Check driver receives: ride:new event\n\n**Step 4: Driver Accepts Ride**\n1. Emit via WebSocket: driver:accept:ride { rideId: '...' }\n2. Check Node.js logs: \"Driver accepted ride\"\n3. Check Laravel logs: \"Ride assigned to driver\"\n4. Customer receives: ride:driver_assigned event\n\n**Step 5: Track Ride**\n1. Emit via WebSocket: driver:location (every 2-3 seconds)\n2. Customer receives: driver:location:update events\n3. Run: \"8. Get Ride Details\" to verify in database\n\n**Step 6: Start and Complete Ride**\n1. Run: \"5. Update Ride Status to Started\"\n2. Customer receives: ride:started event\n3. Run: \"6. Update Ride Status to Completed\"\n4. Customer receives: ride:completed event\n5. Run: \"9. Rate Driver\"\n\n**Step 7: Verify**\n1. Check Laravel database for final ride status\n2. Check all events logged correctly\n3. Check Redis cleaned up: redis-cli HGETALL driver:status:DRIVER_ID"
							}
						}
					]
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "nodejs_url",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "zone_id",
			"value": "778d28d6-1193-436d-9d2b-6c2c31185c8a",
			"type": "string",
			"description": "Cairo/Giza zone ID"
		},
		{
			"key": "auth_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_auth_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "driver_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "ride_id",
			"value": "",
			"type": "string"
		}
	]
}
